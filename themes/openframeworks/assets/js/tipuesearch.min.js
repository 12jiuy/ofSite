function levenshtein(k,u,g,y,v){g=null==g?1:+g;y=null==y?1:+y;v=null==v?1:+v;if(k==u)return 0;var e=k.length,w=u.length;if(0===e)return w*g;if(0===w)return e*v;var l=!1;try{l=!"0"[0]}catch(c){l=!0}l&&(k=k.split(""),u=u.split(""));var l=Array(w+1),x=Array(w+1),q,m,b,n;for(m=0;m<=w;m++)l[m]=m*g;for(q=0;q<e;q++){x[0]=l[0]+v;for(m=0;m<w;m++)b=l[m]+(k[q]==u[m]?0:y),n=l[m+1]+v,n<b&&(b=n),n=x[m]+g,n<b&&(b=n),x[m+1]=b;m=l;l=x;x=m}return b=l[w]}
(function(k){k.fn.tipuesearch=function(u){var g=k.extend({show:7,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},u);return this.each(function(){function u(e){return decodeURIComponent(((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function v(q,m){k("#tipue_search_content").hide();
k("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>');k("#tipue_search_content").show();var b="",n=!1,c=!1,l=!0,r=0;found=[];var f=k("#tipue_search_input").val().toLowerCase(),f=k.trim(f);if(f.match('^"')&&f.match('"$')||f.match("^'")&&f.match("'$"))l=!1;if(l){for(var p=f.split(" "),f="",a=0;a<p.length;a++){for(var h=!0,d=0;d<tipuesearch_stop_words.length;d++)p[a]==tipuesearch_stop_words[d]&&
(h=!1,c=!0);h&&(f=f+" "+p[a])}f=k.trim(f);p=f.split(" ")}else f=f.substring(1,f.length-1);if(f.length>=g.minimumLength){if(l){if(m){for(var u=f,a=0;a<p.length;a++)for(d=0;d<tipuesearch_replace.words.length;d++)p[a]==tipuesearch_replace.words[d].word&&(f=f.replace(p[a],tipuesearch_replace.words[d].replace_with),n=!0);p=f.split(" ")}c=f;for(a=0;a<p.length;a++)for(d=0;d<tipuesearch_stem.words.length;d++)p[a]==tipuesearch_stem.words[d].word&&(c=c+" "+tipuesearch_stem.words[d].stem);p=c.split(" ");for(a=
0;a<e.pages.length;a++){c=0;l=e.pages[a].text;for(d=0;d<p.length;d++){h=new RegExp(p[d],"gi");if(-1!=e.pages[a].title.search(h)){if(null!==e.pages[a].title.match("^"+h+"$"))c+=500;else var t=e.pages[a].title.match(h).length,c=c+50*t;distance=levenshtein(p[d],e.pages[a].title)+1;c+=1/distance*1E3}g.highlightTerms&&(t=g.highlightEveryTerm?new RegExp("("+p[d]+")","gi"):new RegExp("("+p[d]+")","i"),l=l.replace(t,'<span class="h01">$1</span>'));if(-1!=e.pages[a].tags.search(h))for(idx in tags=e.pages[a].tags.split(" "),
tags)-1!=tags[idx].search(h)&&(null!==tags[idx].match("^"+h+"$")?c+=100:(t=tags[idx].match(h).length,c+=10*t),distance=levenshtein(p[d],tags[idx])+1,c+=1/distance*1E3);-1!=e.pages[a].url.search(h)&&(c+=20);if(0!=c)for(h=0;h<tipuesearch_weight.weight.length;h++)e.pages[a].url==tipuesearch_weight.weight[h].url&&(c+=tipuesearch_weight.weight[h].score);p[d].match("^-")&&(h=new RegExp(p[d].substring(1),"i"),-1!=e.pages[a].title.search(h)||-1!=e.pages[a].text.search(h)||-1!=e.pages[a].tags.search(h))&&
(c=0)}0!=c&&(found.push({score:c,title:e.pages[a].title,desc:l,url:e.pages[a].url}),r++)}}else for(a=0;a<e.pages.length;a++){c=0;l=e.pages[a].text;h=new RegExp(f,"gi");-1!=e.pages[a].title.search(h)&&(t=e.pages[a].title.match(h).length,c+=100*t);-1!=e.pages[a].text.search(h)&&(t=e.pages[a].text.match(h).length,c+=20*t);g.highlightTerms&&(t=g.highlightEveryTerm?new RegExp("("+f+")","gi"):new RegExp("("+f+")","i"),l=l.replace(t,'<span class="h01">$1</span>'));-1!=e.pages[a].tags.search(h)&&(t=e.pages[a].tags.match(h).length,
c+=50*t);-1!=e.pages[a].url.search(h)&&(c+=20);if(0!=c)for(h=0;h<tipuesearch_weight.weight.length;h++)e.pages[a].url==tipuesearch_weight.weight[h].url&&(c+=tipuesearch_weight.weight[h].score);0!=c&&(found.push({score:c,title:e.pages[a].title,desc:l,url:e.pages[a].url}),r++)}if(0!=r){g.showTitleCount&&0==w&&(document.title="("+r+") "+document.title,w++);1==n&&(b+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+f+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+u+"</a></div>");
1==r?b+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>":(c_c=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),b+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+"</div>");found.sort(function(a,b){return b.score-a.score});for(a=n=0;a<found.length;a++){if(n>=q&&n<g.show+q&&(b+='<div class="tipue_search_content_title"><a href="'+found[a].url+'"'+x+">"+found[a].title+"</a></div>",g.debug&&(b+='<div class="tipue_search_content_debug">Score: '+found[a].score+
"</div>"),g.showURL&&(d=found[a].url.toLowerCase(),0==d.indexOf("http://")&&(d=d.slice(7)),b+='<div class="tipue_search_content_url"><a href="'+found[a].url+'"'+x+">"+d+"</a></div>"),found[a].desc)){d=found[a].desc;f="";p=d.split(" ");if(p.length<g.descriptiveWords)f=d;else for(d=0;d<g.descriptiveWords;d++)f+=p[d]+" ";f=k.trim(f);"."!=f.charAt(f.length-1)&&(f+=" ...");b+='<div class="tipue_search_content_text">'+f+"</div>"}n++}if(r>g.show){r=Math.ceil(r/g.show);a=q/g.show;b+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';
0<q&&(b+='<li><a class="tipue_search_foot_box" id="'+(q-g.show)+"_"+m+'">'+tipuesearch_string_6+"</a></li>");2>=a?(n=r,3<r&&(n=3),d=0):(n=a+2,n>r&&(n=r),d=a-1);for(;d<n;d++)b=d==a?b+('<li class="current">'+(d+1)+"</li>"):b+('<li><a class="tipue_search_foot_box" id="'+d*g.show+"_"+m+'">'+(d+1)+"</a></li>");a+1!=r&&(b+='<li><a class="tipue_search_foot_box" id="'+(q+g.show)+"_"+m+'">'+tipuesearch_string_7+"</a></li>");b+="</ul></div>"}}else b+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else c?
b+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(b+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",b=1==g.minimumLength?b+('<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>"):b+('<div id="tipue_search_warning">'+tipuesearch_string_12+" "+g.minimumLength+" "+tipuesearch_string_13+"</div>"));k("#tipue_search_content").hide();k("#tipue_search_content").html(b);k("#tipue_search_content").slideDown(200);k("#tipue_search_replaced").click(function(){v(0,
!1)});k(".tipue_search_foot_box").click(function(){var a=k(this).attr("id").split("_");v(parseInt(a[0]),a[1])})}var e={pages:[]};k.ajaxSetup({async:!1});var w=0;if("live"==g.mode)for(var l=0;l<tipuesearch_pages.length;l++)k.get(tipuesearch_pages[l]).done(function(q){var m=k(g.liveContent,q).text(),m=m.replace(/\s+/g," "),b=k(g.liveDescription,q).text(),b=b.replace(/\s+/g," "),n=q.toLowerCase().indexOf("<title>"),c=q.toLowerCase().indexOf("</title>",n+7);q=-1!=n&&-1!=c?q.slice(n+7,c):tipuesearch_string_1;
e.pages.push({title:q,text:b,tags:m,url:tipuesearch_pages[l]})});"json"==g.mode&&k.getJSON(g.contentLocation).done(function(g){e=k.extend({},g)});"static"==g.mode&&(e=k.extend({},tipuesearch));var x="";g.newWindow&&(x=' target="_blank"');u("q")&&(k("#tipue_search_input").val(u("q")),v(0,!0));k(this).keyup(function(e){"13"==e.keyCode&&v(0,!0)})})}})(jQuery);

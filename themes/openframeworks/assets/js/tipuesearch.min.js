function levenshtein(k,u,h,y,v){h=null==h?1:+h;y=null==y?1:+y;v=null==v?1:+v;if(k==u)return 0;var c=k.length,w=u.length;if(0===c)return w*h;if(0===w)return c*v;var l=!1;try{l=!"0"[0]}catch(b){l=!0}l&&(k=k.split(""),u=u.split(""));var l=Array(w+1),x=Array(w+1),q,m,d,n;for(m=0;m<=w;m++)l[m]=m*h;for(q=0;q<c;q++){x[0]=l[0]+v;for(m=0;m<w;m++)d=l[m]+(k[q]==u[m]?0:y),n=l[m+1]+v,n<d&&(d=n),n=x[m]+h,n<d&&(d=n),x[m+1]=d;m=l;l=x;x=m}return d=l[w]}
(function(k){k.fn.tipuesearch=function(u){var h=k.extend({show:7,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},u);return this.each(function(){function u(c){return decodeURIComponent(((new RegExp("[?|&]"+c+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function v(q,m){k("#tipue_search_content").hide();
k("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>');k("#tipue_search_content").show();var d="",n=!1,b=!1,l=!0,r=0;found=[];var g=k("#tipue_search_input").val().toLowerCase(),g=k.trim(g);if(g.match('^"')&&g.match('"$')||g.match("^'")&&g.match("'$"))l=!1;if(l){for(var p=g.split(" "),g="",a=0;a<p.length;a++){for(var e=!0,f=0;f<tipuesearch_stop_words.length;f++)p[a]==tipuesearch_stop_words[f]&&
(e=!1,b=!0);e&&(g=g+" "+p[a])}g=k.trim(g);p=g.split(" ")}else g=g.substring(1,g.length-1);if(g.length>=h.minimumLength){if(l){if(m){for(var u=g,a=0;a<p.length;a++)for(f=0;f<tipuesearch_replace.words.length;f++)p[a]==tipuesearch_replace.words[f].word&&(g=g.replace(p[a],tipuesearch_replace.words[f].replace_with),n=!0);p=g.split(" ")}b=g;for(a=0;a<p.length;a++)for(f=0;f<tipuesearch_stem.words.length;f++)p[a]==tipuesearch_stem.words[f].word&&(b=b+" "+tipuesearch_stem.words[f].stem);p=b.split(" ");for(a=
0;a<c.pages.length;a++){b=0;l=c.pages[a].text;for(f=0;f<p.length;f++){e=new RegExp(p[f],"gi");if(-1!=c.pages[a].title.search(e)){if(null!==c.pages[a].title.match("^"+e+" "))b+=100;else if(null!==c.pages[a].title.match(" "+e+" "))b+=100;else if(null!==c.pages[a].title.match(" "+e+"$"))b+=100;else var t=c.pages[a].title.match(e).length,b=b+10*t;for(qidx in query)-1!=tags[idx].search(query[qidx])&&(distance=levenshtein(query[qidx],c.pages[a].title)+1,b+=1/distance*1E3)}h.highlightTerms&&(t=h.highlightEveryTerm?
new RegExp("("+p[f]+")","gi"):new RegExp("("+p[f]+")","i"),l=l.replace(t,'<span class="h01">$1</span>'));if(-1!=c.pages[a].tags.search(e))for(idx in null!==c.pages[a].tags.match("^"+e+" ")?b+=100:null!==c.pages[a].tags.match(" "+e+" ")?b+=100:null!==c.pages[a].tags.match(" "+e+"$")?b+=100:(t=c.pages[a].tags.match(e).length,b+=10*t),tags=c.pages[a].tags.split(" "),query=e.split(" "),tags)for(qidx in query)-1!=tags[idx].search(query[qidx])&&(distance=levenshtein(query[qidx],tags[idx])+1,b+=1/distance*
1E3);-1!=c.pages[a].url.search(e)&&(b+=20);if(0!=b)for(e=0;e<tipuesearch_weight.weight.length;e++)c.pages[a].url==tipuesearch_weight.weight[e].url&&(b+=tipuesearch_weight.weight[e].score);p[f].match("^-")&&(e=new RegExp(p[f].substring(1),"i"),-1!=c.pages[a].title.search(e)||-1!=c.pages[a].text.search(e)||-1!=c.pages[a].tags.search(e))&&(b=0)}0!=b&&(found.push({score:b,title:c.pages[a].title,desc:l,url:c.pages[a].url}),r++)}}else for(a=0;a<c.pages.length;a++){b=0;l=c.pages[a].text;e=new RegExp(g,"gi");
if(-1!=c.pages[a].title.search(e))for(qidx in null!==c.pages[a].title.match("^"+e+" ")?b+=100:null!==c.pages[a].title.match(" "+e+" ")?b+=100:null!==c.pages[a].title.match(" "+e+"$")?b+=100:(t=c.pages[a].title.match(e).length,b+=10*t),query)-1!=tags[idx].search(query[qidx])&&(distance=levenshtein(query[qidx],c.pages[a].title)+1,b+=1/distance*1E3);-1!=c.pages[a].text.search(e)&&(t=c.pages[a].text.match(e).length,b+=20*t);h.highlightTerms&&(t=h.highlightEveryTerm?new RegExp("("+g+")","gi"):new RegExp("("+
g+")","i"),l=l.replace(t,'<span class="h01">$1</span>'));if(-1!=c.pages[a].tags.search(e))for(idx in null!==c.pages[a].tags.match("^"+e+" ")?b+=100:null!==c.pages[a].tags.match(" "+e+" ")?b+=100:null!==c.pages[a].tags.match(" "+e+"$")?b+=100:(t=c.pages[a].tags.match(e).length,b+=10*t),tags=c.pages[a].tags.split(" "),query=e.split(" "),tags)for(qidx in query)-1!=tags[idx].search(query[qidx])&&(distance=levenshtein(query[qidx],tags[idx])+1,b+=1/distance*1E3);-1!=c.pages[a].url.search(e)&&(b+=20);if(0!=
b)for(e=0;e<tipuesearch_weight.weight.length;e++)c.pages[a].url==tipuesearch_weight.weight[e].url&&(b+=tipuesearch_weight.weight[e].score);0!=b&&(found.push({score:b,title:c.pages[a].title,desc:l,url:c.pages[a].url}),r++)}if(0!=r){h.showTitleCount&&0==w&&(document.title="("+r+") "+document.title,w++);1==n&&(d+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+g+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+u+"</a></div>");1==r?d+='<div id="tipue_search_results_count">'+tipuesearch_string_4+
"</div>":(c_c=r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),d+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+"</div>");found.sort(function(a,b){return b.score-a.score});for(a=n=0;a<found.length;a++){if(n>=q&&n<h.show+q&&(d+='<div class="tipue_search_content_title"><a href="'+found[a].url+'"'+x+">"+found[a].title+"</a></div>",h.debug&&(d+='<div class="tipue_search_content_debug">Score: '+found[a].score+"</div>"),h.showURL&&(f=found[a].url.toLowerCase(),0==f.indexOf("http://")&&
(f=f.slice(7)),d+='<div class="tipue_search_content_url"><a href="'+found[a].url+'"'+x+">"+f+"</a></div>"),found[a].desc)){f=found[a].desc;g="";p=f.split(" ");if(p.length<h.descriptiveWords)g=f;else for(f=0;f<h.descriptiveWords;f++)g+=p[f]+" ";g=k.trim(g);"."!=g.charAt(g.length-1)&&(g+=" ...");d+='<div class="tipue_search_content_text">'+g+"</div>"}n++}if(r>h.show){r=Math.ceil(r/h.show);a=q/h.show;d+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';0<q&&(d+='<li><a class="tipue_search_foot_box" id="'+
(q-h.show)+"_"+m+'">'+tipuesearch_string_6+"</a></li>");2>=a?(n=r,3<r&&(n=3),f=0):(n=a+2,n>r&&(n=r),f=a-1);for(;f<n;f++)d=f==a?d+('<li class="current">'+(f+1)+"</li>"):d+('<li><a class="tipue_search_foot_box" id="'+f*h.show+"_"+m+'">'+(f+1)+"</a></li>");a+1!=r&&(d+='<li><a class="tipue_search_foot_box" id="'+(q+h.show)+"_"+m+'">'+tipuesearch_string_7+"</a></li>");d+="</ul></div>"}}else d+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else b?d+='<div id="tipue_search_warning">'+tipuesearch_string_8+
". "+tipuesearch_string_9+"</div>":(d+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",d=1==h.minimumLength?d+('<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>"):d+('<div id="tipue_search_warning">'+tipuesearch_string_12+" "+h.minimumLength+" "+tipuesearch_string_13+"</div>"));k("#tipue_search_content").hide();k("#tipue_search_content").html(d);k("#tipue_search_content").slideDown(200);k("#tipue_search_replaced").click(function(){v(0,!1)});k(".tipue_search_foot_box").click(function(){var a=
k(this).attr("id").split("_");v(parseInt(a[0]),a[1])})}var c={pages:[]};k.ajaxSetup({async:!1});var w=0;if("live"==h.mode)for(var l=0;l<tipuesearch_pages.length;l++)k.get(tipuesearch_pages[l]).done(function(q){var m=k(h.liveContent,q).text(),m=m.replace(/\s+/g," "),d=k(h.liveDescription,q).text(),d=d.replace(/\s+/g," "),n=q.toLowerCase().indexOf("<title>"),b=q.toLowerCase().indexOf("</title>",n+7);q=-1!=n&&-1!=b?q.slice(n+7,b):tipuesearch_string_1;c.pages.push({title:q,text:d,tags:m,url:tipuesearch_pages[l]})});
"json"==h.mode&&k.getJSON(h.contentLocation).done(function(h){c=k.extend({},h)});"static"==h.mode&&(c=k.extend({},tipuesearch));var x="";h.newWindow&&(x=' target="_blank"');u("q")&&(k("#tipue_search_input").val(u("q")),v(0,!0));k(this).keyup(function(c){"13"==c.keyCode&&v(0,!0)})})}})(jQuery);

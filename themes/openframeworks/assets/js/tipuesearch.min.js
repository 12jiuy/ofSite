(function(k){k.fn.tipuesearch=function(z){var h=k.extend({show:7,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},z);return this.each(function(){function x(c){return decodeURIComponent(((new RegExp("[?|&]"+c+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function v(n,t){k("#tipue_search_content").hide();
k("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>');k("#tipue_search_content").show();var f="",m=!1,b=!1,r=!0,p=0;found=[];var g=k("#tipue_search_input").val().toLowerCase(),g=k.trim(g);if(g.match('^"')&&g.match('"$')||g.match("^'")&&g.match("'$"))r=!1;if(r){for(var l=g.split(" "),g="",a=0;a<l.length;a++){for(var d=!0,e=0;e<tipuesearch_stop_words.length;e++)l[a]==tipuesearch_stop_words[e]&&
(d=!1,b=!0);d&&(g=g+" "+l[a])}g=k.trim(g);l=g.split(" ")}else g=g.substring(1,g.length-1);if(g.length>=h.minimumLength){if(r){if(t){for(var u=g,a=0;a<l.length;a++)for(e=0;e<tipuesearch_replace.words.length;e++)l[a]==tipuesearch_replace.words[e].word&&(g=g.replace(l[a],tipuesearch_replace.words[e].replace_with),m=!0);l=g.split(" ")}b=g;for(a=0;a<l.length;a++)for(e=0;e<tipuesearch_stem.words.length;e++)l[a]==tipuesearch_stem.words[e].word&&(b=b+" "+tipuesearch_stem.words[e].stem);l=b.split(" ");for(a=
0;a<c.pages.length;a++){b=0;r=c.pages[a].text;for(e=0;e<l.length;e++){d=new RegExp(l[e],"gi");if(-1!=c.pages[a].title.search(d))if(null!==c.pages[a].title.match("^"+d+" "))b+=100;else if(null!==c.pages[a].title.match(" "+d+" "))b+=100;else if(null!==c.pages[a].title.match(" "+d+"$"))b+=100;else var q=c.pages[a].title.match(d).length,b=b+10*q;h.highlightTerms&&(q=h.highlightEveryTerm?new RegExp("("+l[e]+")","gi"):new RegExp("("+l[e]+")","i"),r=r.replace(q,'<span class="h01">$1</span>'));-1!=c.pages[a].tags.search(d)&&
(null!==c.pages[a].tags.match("^"+d+" ")?b+=100:null!==c.pages[a].tags.match(" "+d+" ")?b+=100:null!==c.pages[a].tags.match(" "+d+"$")?b+=100:(q=c.pages[a].tags.match(d).length,b+=10*q));-1!=c.pages[a].url.search(d)&&(b+=20);if(0!=b)for(d=0;d<tipuesearch_weight.weight.length;d++)c.pages[a].url==tipuesearch_weight.weight[d].url&&(b+=tipuesearch_weight.weight[d].score);l[e].match("^-")&&(d=new RegExp(l[e].substring(1),"i"),-1!=c.pages[a].title.search(d)||-1!=c.pages[a].text.search(d)||-1!=c.pages[a].tags.search(d))&&
(b=0)}0!=b&&(found.push({score:b,title:c.pages[a].title,desc:r,url:c.pages[a].url}),p++)}}else for(a=0;a<c.pages.length;a++){b=0;r=c.pages[a].text;d=new RegExp(g,"gi");-1!=c.pages[a].title.search(d)&&(null!==c.pages[a].title.match("^"+d+" ")?b+=100:null!==c.pages[a].title.match(" "+d+" ")?b+=100:null!==c.pages[a].title.match(" "+d+"$")?b+=100:(q=c.pages[a].title.match(d).length,b+=10*q));-1!=c.pages[a].text.search(d)&&(q=c.pages[a].text.match(d).length,b+=20*q);h.highlightTerms&&(q=h.highlightEveryTerm?
new RegExp("("+g+")","gi"):new RegExp("("+g+")","i"),r=r.replace(q,'<span class="h01">$1</span>'));-1!=c.pages[a].tags.search(d)&&(null!==c.pages[a].tags.match("^"+d+" ")?b+=100:null!==c.pages[a].tags.match(" "+d+" ")?b+=100:null!==c.pages[a].tags.match(" "+d+"$")?b+=100:(q=c.pages[a].tags.match(d).length,b+=10*q));-1!=c.pages[a].url.search(d)&&(b+=20);if(0!=b)for(d=0;d<tipuesearch_weight.weight.length;d++)c.pages[a].url==tipuesearch_weight.weight[d].url&&(b+=tipuesearch_weight.weight[d].score);0!=
b&&(found.push({score:b,title:c.pages[a].title,desc:r,url:c.pages[a].url}),p++)}if(0!=p){h.showTitleCount&&0==y&&(document.title="("+p+") "+document.title,y++);1==m&&(f+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+g+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+u+"</a></div>");1==p?f+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>":(c_c=p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),f+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+
"</div>");found.sort(function(a,b){return b.score-a.score});for(a=m=0;a<found.length;a++){if(m>=n&&m<h.show+n&&(f+='<div class="tipue_search_content_title"><a href="'+found[a].url+'"'+w+">"+found[a].title+"</a></div>",h.debug&&(f+='<div class="tipue_search_content_debug">Score: '+found[a].score+"</div>"),h.showURL&&(e=found[a].url.toLowerCase(),0==e.indexOf("http://")&&(e=e.slice(7)),f+='<div class="tipue_search_content_url"><a href="'+found[a].url+'"'+w+">"+e+"</a></div>"),found[a].desc)){e=found[a].desc;
g="";l=e.split(" ");if(l.length<h.descriptiveWords)g=e;else for(e=0;e<h.descriptiveWords;e++)g+=l[e]+" ";g=k.trim(g);"."!=g.charAt(g.length-1)&&(g+=" ...");f+='<div class="tipue_search_content_text">'+g+"</div>"}m++}if(p>h.show){p=Math.ceil(p/h.show);a=n/h.show;f+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';0<n&&(f+='<li><a class="tipue_search_foot_box" id="'+(n-h.show)+"_"+t+'">'+tipuesearch_string_6+"</a></li>");2>=a?(m=p,3<p&&(m=3),e=0):(m=a+2,m>p&&(m=p),e=a-1);for(;e<m;e++)f=
e==a?f+('<li class="current">'+(e+1)+"</li>"):f+('<li><a class="tipue_search_foot_box" id="'+e*h.show+"_"+t+'">'+(e+1)+"</a></li>");a+1!=p&&(f+='<li><a class="tipue_search_foot_box" id="'+(n+h.show)+"_"+t+'">'+tipuesearch_string_7+"</a></li>");f+="</ul></div>"}}else f+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else b?f+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(f+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",
f=1==h.minimumLength?f+('<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>"):f+('<div id="tipue_search_warning">'+tipuesearch_string_12+" "+h.minimumLength+" "+tipuesearch_string_13+"</div>"));k("#tipue_search_content").hide();k("#tipue_search_content").html(f);k("#tipue_search_content").slideDown(200);k("#tipue_search_replaced").click(function(){v(0,!1)});k(".tipue_search_foot_box").click(function(){var a=k(this).attr("id").split("_");v(parseInt(a[0]),a[1])})}var c={pages:[]};k.ajaxSetup({async:!1});
var y=0;if("live"==h.mode)for(var u=0;u<tipuesearch_pages.length;u++)k.get(tipuesearch_pages[u]).done(function(n){var t=k(h.liveContent,n).text(),t=t.replace(/\s+/g," "),f=k(h.liveDescription,n).text(),f=f.replace(/\s+/g," "),m=n.toLowerCase().indexOf("<title>"),b=n.toLowerCase().indexOf("</title>",m+7);n=-1!=m&&-1!=b?n.slice(m+7,b):tipuesearch_string_1;c.pages.push({title:n,text:f,tags:t,url:tipuesearch_pages[u]})});"json"==h.mode&&k.getJSON(h.contentLocation).done(function(h){c=k.extend({},h)});
"static"==h.mode&&(c=k.extend({},tipuesearch));var w="";h.newWindow&&(w=' target="_blank"');x("q")&&(k("#tipue_search_input").val(x("q")),v(0,!0));k(this).keyup(function(c){"13"==c.keyCode&&v(0,!0)})})}})(jQuery);

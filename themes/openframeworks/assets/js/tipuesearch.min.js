(function(k){k.fn.tipuesearch=function(z){var h=k.extend({show:7,newWindow:!1,showURL:!0,showTitleCount:!0,minimumLength:3,descriptiveWords:25,highlightTerms:!0,highlightEveryTerm:!1,mode:"static",liveDescription:"*",liveContent:"*",contentLocation:"tipuesearch/tipuesearch_content.json",debug:!1},z);return this.each(function(){function x(f){return decodeURIComponent(((new RegExp("[?|&]"+f+"=([^&;]+?)(&|#|;|$)")).exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function v(p,t){k("#tipue_search_content").hide();
k("#tipue_search_content").html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>');k("#tipue_search_content").show();var c="",m=!1,d=!1,r=!0,q=0;found=[];var e=k("#tipue_search_input").val().toLowerCase(),e=k.trim(e);if(e.match('^"')&&e.match('"$')||e.match("^'")&&e.match("'$"))r=!1;if(r){for(var l=e.split(" "),e="",a=0;a<l.length;a++){for(var g=!0,b=0;b<tipuesearch_stop_words.length;b++)l[a]==tipuesearch_stop_words[b]&&
(g=!1,d=!0);g&&(e=e+" "+l[a])}e=k.trim(e);l=e.split(" ")}else e=e.substring(1,e.length-1);if(e.length>=h.minimumLength){if(r){if(t){for(var u=e,a=0;a<l.length;a++)for(b=0;b<tipuesearch_replace.words.length;b++)l[a]==tipuesearch_replace.words[b].word&&(e=e.replace(l[a],tipuesearch_replace.words[b].replace_with),m=!0);l=e.split(" ")}d=e;for(a=0;a<l.length;a++)for(b=0;b<tipuesearch_stem.words.length;b++)l[a]==tipuesearch_stem.words[b].word&&(d=d+" "+tipuesearch_stem.words[b].stem);l=d.split(" ");for(a=
0;a<f.pages.length;a++){d=0;r=f.pages[a].text;for(b=0;b<l.length;b++){g=new RegExp(l[b],"gi");if(-1!=f.pages[a].title.search(g))var n=f.pages[a].title.match(g).length,d=d+200*n;-1!=f.pages[a].text.search(g)&&(n=f.pages[a].text.match(g).length,d+=20*n);h.highlightTerms&&(n=h.highlightEveryTerm?new RegExp("("+l[b]+")","gi"):new RegExp("("+l[b]+")","i"),r=r.replace(n,'<span class="h01">$1</span>'));-1!=f.pages[a].tags.search(g)&&(n=f.pages[a].tags.match(g).length,d+=100*n);-1!=f.pages[a].url.search(g)&&
(d+=20);if(0!=d)for(g=0;g<tipuesearch_weight.weight.length;g++)f.pages[a].url==tipuesearch_weight.weight[g].url&&(d+=tipuesearch_weight.weight[g].score);l[b].match("^-")&&(g=new RegExp(l[b].substring(1),"i"),-1!=f.pages[a].title.search(g)||-1!=f.pages[a].text.search(g)||-1!=f.pages[a].tags.search(g))&&(d=0)}0!=d&&(found.push({score:d,title:f.pages[a].title,desc:r,url:f.pages[a].url}),q++)}}else for(a=0;a<f.pages.length;a++){d=0;r=f.pages[a].text;g=new RegExp(e,"gi");-1!=f.pages[a].title.search(g)&&
(n=f.pages[a].title.match(g).length,d+=200*n);-1!=f.pages[a].text.search(g)&&(n=f.pages[a].text.match(g).length,d+=20*n);h.highlightTerms&&(n=h.highlightEveryTerm?new RegExp("("+e+")","gi"):new RegExp("("+e+")","i"),r=r.replace(n,'<span class="h01">$1</span>'));-1!=f.pages[a].tags.search(g)&&(n=f.pages[a].tags.match(g).length,d+=100*n);-1!=f.pages[a].url.search(g)&&(d+=20);if(0!=d)for(g=0;g<tipuesearch_weight.weight.length;g++)f.pages[a].url==tipuesearch_weight.weight[g].url&&(d+=tipuesearch_weight.weight[g].score);
0!=d&&(found.push({score:d,title:f.pages[a].title,desc:r,url:f.pages[a].url}),q++)}if(0!=q){h.showTitleCount&&0==y&&(document.title="("+q+") "+document.title,y++);1==m&&(c+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+e+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+u+"</a></div>");1==q?c+='<div id="tipue_search_results_count">'+tipuesearch_string_4+"</div>":(c_c=q.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),c+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5+
"</div>");found.sort(function(a,b){return b.score-a.score});for(a=m=0;a<found.length;a++){if(m>=p&&m<h.show+p&&(c+='<div class="tipue_search_content_title"><a href="'+found[a].url+'"'+w+">"+found[a].title+"</a></div>",h.debug&&(c+='<div class="tipue_search_content_debug">Score: '+found[a].score+"</div>"),h.showURL&&(b=found[a].url.toLowerCase(),0==b.indexOf("http://")&&(b=b.slice(7)),c+='<div class="tipue_search_content_url"><a href="'+found[a].url+'"'+w+">"+b+"</a></div>"),found[a].desc)){b=found[a].desc;
e="";l=b.split(" ");if(l.length<h.descriptiveWords)e=b;else for(b=0;b<h.descriptiveWords;b++)e+=l[b]+" ";e=k.trim(e);"."!=e.charAt(e.length-1)&&(e+=" ...");c+='<div class="tipue_search_content_text">'+e+"</div>"}m++}if(q>h.show){q=Math.ceil(q/h.show);a=p/h.show;c+='<div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">';0<p&&(c+='<li><a class="tipue_search_foot_box" id="'+(p-h.show)+"_"+t+'">'+tipuesearch_string_6+"</a></li>");2>=a?(m=q,3<q&&(m=3),b=0):(m=a+2,m>q&&(m=q),b=a-1);for(;b<m;b++)c=
b==a?c+('<li class="current">'+(b+1)+"</li>"):c+('<li><a class="tipue_search_foot_box" id="'+b*h.show+"_"+t+'">'+(b+1)+"</a></li>");a+1!=q&&(c+='<li><a class="tipue_search_foot_box" id="'+(p+h.show)+"_"+t+'">'+tipuesearch_string_7+"</a></li>");c+="</ul></div>"}}else c+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else d?c+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(c+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",
c=1==h.minimumLength?c+('<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>"):c+('<div id="tipue_search_warning">'+tipuesearch_string_12+" "+h.minimumLength+" "+tipuesearch_string_13+"</div>"));k("#tipue_search_content").hide();k("#tipue_search_content").html(c);k("#tipue_search_content").slideDown(200);k("#tipue_search_replaced").click(function(){v(0,!1)});k(".tipue_search_foot_box").click(function(){var a=k(this).attr("id").split("_");v(parseInt(a[0]),a[1])})}var f={pages:[]};k.ajaxSetup({async:!1});
var y=0;if("live"==h.mode)for(var u=0;u<tipuesearch_pages.length;u++)k.get(tipuesearch_pages[u]).done(function(p){var t=k(h.liveContent,p).text(),t=t.replace(/\s+/g," "),c=k(h.liveDescription,p).text(),c=c.replace(/\s+/g," "),m=p.toLowerCase().indexOf("<title>"),d=p.toLowerCase().indexOf("</title>",m+7);p=-1!=m&&-1!=d?p.slice(m+7,d):tipuesearch_string_1;f.pages.push({title:p,text:c,tags:t,url:tipuesearch_pages[u]})});"json"==h.mode&&k.getJSON(h.contentLocation).done(function(h){f=k.extend({},h)});
"static"==h.mode&&(f=k.extend({},tipuesearch));var w="";h.newWindow&&(w=' target="_blank"');x("q")&&(k("#tipue_search_input").val(x("q")),v(0,!0));k(this).keyup(function(f){"13"==f.keyCode&&v(0,!0)})})}})(jQuery);
